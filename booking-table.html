<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bookings - Gramin</title>
<link rel="stylesheet" href="./styles.css">
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <h1 class="brand">Gramin Vehicle Booking</h1>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="vehicles.html">Vehicles</a>
      <a href="booking.html">Book Now</a>
      <a href="booking-table.html">Bookings</a>
    </nav>
  </div>
</header>

<main class="container">
  <h2 style="text-align:center;margin:18px 0">Booking Records</h2>

  <table id="bookingTable" class="data-table">
    <thead>
      <tr>
        <th>Name</th><th>Mobile</th><th>Pickup</th><th>Drop</th><th>Vehicle</th><th>Date</th><th>Time</th>
      </tr>
    </thead>
    <tbody id="tableBody">
    </tbody>
  </table>

  <div style="text-align:center;margin-top:12px">
    <button id="clearStorage" class="btn ghost">Clear Local Bookings</button>
  </div>
</main>

<script>
// YOUR BACKEND URL
const API_URL = "https://gramin-backend-fixed.onrender.com/api/bookings";

async function loadFromBackend() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();

    const tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = "";

    data.forEach(b => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${b.name}</td>
        <td>${b.mobile}</td>
        <td>${b.pickup}</td>
        <td>${b.drop}</td>
        <td>${b.vehicle}</td>
        <td>${b.date}</td>
        <td>${b.time}</td>
      `;
      tableBody.appendChild(tr);
    });
  } catch (err) {
    console.log("Backend error, loading from localStorage...", err);
    loadLocal();
  }
}

// Load from localStorage if backend fails
function loadLocal() {
  const list = JSON.parse(localStorage.getItem("gv_bookings") || "[]");
  const tableBody = document.getElementById("tableBody");
  tableBody.innerHTML = "";
  list.forEach(b => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${b.name}</td>
      <td>${b.mobile}</td>
      <td>${b.pickup}</td>
      <td>${b.drop}</td>
      <td>${b.vehicle}</td>
      <td>${b.date}</td>
      <td>${b.time}</td>
    `;
    tableBody.appendChild(tr);
  });
}

document.addEventListener("DOMContentLoaded", loadFromBackend);
</script>

<script src="./script.js"></script>
</body>
</html>
